{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/effect/useThrottle/useThrottle.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport { AnyFunction, __GLOBAL__ } from \"@m78/utils\";\nimport { useFn, useSelf } from \"@m78/hooks\";\n\nexport interface UseThrottleOption {\n  /** true | 在节流开始前调用 */\n  leading?: boolean;\n  /** true | 在节流结束后调用 */\n  trailing?: boolean;\n}\n\nconst defaultOption = {\n  leading: true,\n  trailing: true,\n};\n\n/**\n * 传入一个函数，经过节流处理后返回, 返回函数的内存地址会一直保持不变\n * @param fn - 待节流的函数\n * @param wait - 节流延迟时间\n * @param options\n * @param options.leading - true | 在节流开始前调用\n * @param options.trailing - true | 在节流结束后调用\n * @returns throttleFn - 经过节流处理后的函数\n * @returns throttleFn.cancel() - 取消节流调用\n */\nexport function useThrottle<T extends AnyFunction>(\n  fn: T,\n  wait = 300,\n  options?: UseThrottleOption\n) {\n  const self = useSelf({\n    last: 0,\n    timer: undefined as any,\n  });\n\n  const opt = {\n    ...defaultOption,\n    ...options,\n  };\n\n  const cancel = useFn(() => {\n    if (self.timer) {\n      __GLOBAL__.clearTimeout(self.timer);\n    }\n  });\n\n  useEffect(() => {\n    return cancel;\n  });\n\n  const memoFn = useFn((...args) => {\n    const now = Date.now();\n    const diff = now - self.last;\n\n    cancel();\n\n    if (diff > wait) {\n      // last = 0 时视为初次调用\n      if (opt.leading || self.last !== 0) {\n        fn(...args);\n      }\n      self.last = now;\n    } else if (opt.trailing) {\n      self.timer = __GLOBAL__.setTimeout(() => {\n        fn(...args);\n        self.last = 0; // 标记下次调用为leading调用\n        __GLOBAL__.clearTimeout(self.timer);\n      }, wait);\n    }\n  });\n\n  const bundle = Object.assign(memoFn as T, {\n    cancel,\n  });\n\n  return bundle;\n}\n"],"names":["useEffect","__GLOBAL__","useFn","useSelf","defaultOption","leading","trailing","useThrottle","fn","wait","options","self","last","timer","undefined","opt","cancel","clearTimeout","memoFn","args","now","Date","diff","setTimeout","bundle","Object","assign"],"mappings":"AAAA;;AAAA,SAASA,SAAS,QAAQ,OAAO,CAAC;AAClC,SAAsBC,UAAU,QAAQ,YAAY,CAAC;AACrD,SAASC,KAAK,EAAEC,OAAO,QAAQ,YAAY,CAAC;AAS5C,IAAMC,aAAa,GAAG;IACpBC,OAAO,EAAE,IAAI;IACbC,QAAQ,EAAE,IAAI;CACf,AAAC;AAEF;;;;;;;;;CASC,GACD,OAAO,SAASC,WAAW,CACzBC,EAAK,EAGL;QAFAC,IAAI,GAAJA,+CAAU,kBAAH,GAAG,EACVC,OAA2B,+CAAA;IAE3B,IAAMC,IAAI,GAAGR,OAAO,CAAC;QACnBS,IAAI,EAAE,CAAC;QACPC,KAAK,EAAEC,SAAS;KACjB,CAAC,AAAC;IAEH,IAAMC,GAAG,GAAG,mBACPX,aAAa,EACbM,OAAO,CACX,AAAC;IAEF,IAAMM,MAAM,GAAGd,KAAK,CAAC,WAAM;QACzB,IAAIS,IAAI,CAACE,KAAK,EAAE;YACdZ,UAAU,CAACgB,YAAY,CAACN,IAAI,CAACE,KAAK,CAAC,CAAC;QACtC,CAAC;IACH,CAAC,CAAC,AAAC;IAEHb,SAAS,CAAC,WAAM;QACd,OAAOgB,MAAM,CAAC;IAChB,CAAC,CAAC,CAAC;IAEH,IAAME,MAAM,GAAGhB,KAAK,CAAC,WAAa;yCAATiB,IAAI;YAAJA,IAAI;;QAC3B,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE,AAAC;QACvB,IAAME,IAAI,GAAGF,GAAG,GAAGT,IAAI,CAACC,IAAI,AAAC;QAE7BI,MAAM,EAAE,CAAC;QAET,IAAIM,IAAI,GAAGb,IAAI,EAAE;YACf,mBAAmB;YACnB,IAAIM,GAAG,CAACV,OAAO,IAAIM,IAAI,CAACC,IAAI,KAAK,CAAC,EAAE;gBAClCJ,EAAE,CAAFA,KAAW,CAAXA,KAAAA,CAAE,EAAC,qBAAGW,IAAI,CAAJA,CAAK,CAAC;YACd,CAAC;YACDR,IAAI,CAACC,IAAI,GAAGQ,GAAG,CAAC;QAClB,OAAO,IAAIL,GAAG,CAACT,QAAQ,EAAE;YACvBK,IAAI,CAACE,KAAK,GAAGZ,UAAU,CAACsB,UAAU,CAAC,WAAM;gBACvCf,EAAE,CAAFA,KAAW,CAAXA,KAAAA,CAAE,EAAC,qBAAGW,IAAI,CAAJA,CAAK,CAAC;gBACZR,IAAI,CAACC,IAAI,GAAG,CAAC,CAAC,CAAC,mBAAmB;gBAClCX,UAAU,CAACgB,YAAY,CAACN,IAAI,CAACE,KAAK,CAAC,CAAC;YACtC,CAAC,EAAEJ,IAAI,CAAC,CAAC;QACX,CAAC;IACH,CAAC,CAAC,AAAC;IAEH,IAAMe,MAAM,GAAGC,MAAM,CAACC,MAAM,CAACR,MAAM,EAAO;QACxCF,MAAM,EAANA,MAAM;KACP,CAAC,AAAC;IAEH,OAAOQ,MAAM,CAAC;AAChB,CAAC"}