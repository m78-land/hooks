{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/effect/useFetch/useFetch.ts"],"sourcesContent":["import { __GLOBAL__, isEmpty, isFunction, isObject } from \"@m78/utils\";\nimport _debounce from \"lodash/debounce\";\nimport _throttle from \"lodash/throttle\";\nimport React, { useEffect, useState } from \"react\";\nimport {\n  useEffectEqual,\n  useFn,\n  useSelf,\n  useSetState,\n  useStorageState,\n  SetStateBase,\n} from \"@m78/hooks\";\n\nconst GLOBAL = __GLOBAL__ as Window;\n\n/* TODO: 自动重试、窗口聚焦、失焦 */\n\ninterface UseFetchOptions<Data, Payload> {\n  /** [] | 类似useEffect(fn, deps)，当依赖数组内的值发生改变时，会以当前参数进行更新请求, 请勿传入未memo的引用类型值 */\n  deps?: any[];\n  /** 传递给请求函数的参数, 当发生改变时，会以新值发起调用请求。传递此项时，Payload会被忽略。与payload共用Payload类型 */\n  param?: Payload;\n  /** false | 只能通过send来触发请求 */\n  manual?: boolean;\n  /** 10000 | 超时时间 ms */\n  timeout?: number;\n  /** true | 只有为true时才会发起请求, 可以用来实现串联请求 */\n  pass?: boolean;\n  /** 初始data */\n  initData?: (() => Data) | Data;\n  /** 初始payload, 在不存在param配置时，作为参数传递给请求方法 */\n  initPayload?: (() => Payload) | Payload;\n  /** 成功回调, 当为更新请求(通过无参调用send、deps等配置发起请求)时，isUpdate为true */\n  onSuccess?: (result: Data, isUpdate: boolean) => void;\n  /** 错误回调， error为请求函数中抛出的错误 */\n  onError?: (error: any) => void;\n  /** 无论成功与否都会调用。在旧的请求被新的请求覆盖掉时，不会触发。 */\n  onComplete?: () => void;\n  /** 请求超时的回调 */\n  onTimeout?: () => void;\n  /** 用于缓存的key，传递后，会将(payload, data, arg)缓存到session中，下次加载时将读取缓存数据作为初始值 */\n  cacheKey?: string;\n  /** true | 当传入了cacheKey且存在缓存数据时，是否进行swr(stale-while-revalidate)请求 */\n  stale?: boolean;\n  /** 节流间隔时间，传入时，开启节流, 只有初始化时的配置会生效 */\n  throttleInterval?: number;\n  /** 防抖间隔时间，传入时，开启防抖, 只有初始化时的配置会生效, 当存在throttleInterval时，此配置不会生效 */\n  debounceInterval?: number;\n  /** 轮询间隔, 大于500时生效 */\n  pollingInterval?: number;\n}\n\ninterface UseFetchReturns<Data, Payload> {\n  /** 是否正在请求 */\n  loading: boolean;\n  /** method方法reject时，error为它reject的值。 */\n  error: any;\n  /** 请求超时设置为true */\n  timeout: boolean;\n  /** method方法resolve的值或initData */\n  data: Data;\n  /** 当前用于请求的payload或initPayload */\n  payload: Payload;\n  /** 当前用于请求的param */\n  param: Payload;\n  /** 设置当前的data */\n  setData: SetStateBase<Data>;\n  /** 取消请求 */\n  cancel: () => void;\n  /** 轮询的开关状态，轮询还依赖于pollingInterval配置，只有两者同时有效时才会开启轮询 */\n  polling: boolean;\n  /** 设置轮询状态 */\n  setPolling(patch: boolean | ((prev: boolean) => boolean)): void;\n  /**\n   * 根据参数类型不同，会有不同效果:\n   * - 带参数: 以新的payload发起请求并设置payload\n   * - 无参数/参数为合成事件: 以当前参数发起更新请求\n   * - 传入了param配置项: 当存在param配置，一律视为更新并以当前param的值发起更新. 此时，传入的payload会被忽略\n   *\n   * 返回错误优先的Promise:\n   * - 如果该次请求有效，返回一个必定resolve数组[err, res]的Promise，err为reject的结果(不为null说明该次请求发生了错误)，res为resolve的结果\n   * - 如果请求被pass等阻断，返回数组的第一线会是一个错误对象\n   * */\n  send: (\n    newPayload?:\n      | Payload\n      | React.SyntheticEvent\n      | undefined /* SyntheticEvent是为了直接将send绑定给onClick等时不出现类型错误 */\n  ) => Promise<[any, Data]>;\n}\n\n/** 简单的判断是否为合成事件 */\nfunction isSyntheticEvent(arg: any) {\n  if (!arg) return false;\n\n  return (\n    isObject(arg) && \"nativeEvent\" in arg && \"target\" in arg && \"type\" in arg\n  );\n}\n\nfunction useFetch<Data = any, Payload = any>(\n  /** 一个Promise return函数或async函数, 当不为函数时不会走请求流程 */\n  method?: ((...arg: any[]) => Promise<Data>) | any,\n  /** 配置项 */\n  options = {} as UseFetchOptions<Data, Payload>\n) {\n  const self = useSelf({\n    /** 请求的唯一标示，在每一次请求开始前更新，并作为请求有效性的凭据 */\n    fetchID: 0,\n    /** 完成请求次数 */\n    fetchCount: 0,\n    /** 超时计时器 */\n    timeoutTimer: 0,\n    /** 处理轮询状态 */\n    lastFetch: Date.now(),\n  });\n  const {\n    initData,\n    initPayload,\n    deps = [],\n    param,\n    manual = false,\n    timeout = 10000,\n    onSuccess,\n    onError,\n    onComplete,\n    onTimeout,\n    cacheKey,\n    stale = true,\n    throttleInterval,\n    debounceInterval,\n    pollingInterval,\n    pass: aPass = true,\n  } = options;\n\n  const isCache = !!cacheKey; // 包含用于缓存的key并且非isPost时，缓存才会生效\n\n  const pass = aPass && isFunction(method);\n\n  const [state, setState] = useSetState({\n    loading: !manual && pass,\n    error: undefined as any,\n    timeout: false,\n  });\n\n  // 防止卸载后赋值\n  useEffect(() => {\n    return () => {\n      self.fetchID = 0; // 超时后阻止后续赋值操作\n      self.timeoutTimer && GLOBAL.clearTimeout(self.timeoutTimer);\n    };\n  }, []);\n\n  const [payload, setPayload] = useStorageState(\n    `${cacheKey}_FETCH_PAYLOAD`,\n    initPayload,\n    {\n      disabled: !isCache,\n    }\n  );\n\n  const [data, setData] = useStorageState(`${cacheKey}_FETCH_DATA`, initData, {\n    disabled: !isCache,\n  });\n\n  const [polling, setPolling] = useState(true);\n\n  const fetchHandel = useFn(\n    async function _fetchHandel(args: any, isUpdate = false) {\n      if (!pass) {\n        return [new Error(\"the request has been ignored\"), null];\n      }\n\n      self.lastFetch = Date.now();\n\n      const cID = Math.random();\n      self.fetchID = cID;\n\n      // 清除上一个计时器\n      self.timeoutTimer && GLOBAL.clearTimeout(self.timeoutTimer);\n      self.timeoutTimer = GLOBAL.setTimeout(() => {\n        cancel();\n        onTimeout?.();\n        setState({\n          ...getResetState(\"timeout\", true),\n        });\n      }, timeout);\n\n      // 记录当前计时器\n      const cTimeoutTimer = self.timeoutTimer;\n\n      // 减少更新次数\n      if (!state.loading) {\n        setState({\n          ...getResetState(\"loading\", true),\n        });\n      }\n\n      try {\n        const res = await method(args);\n        if (cID === self.fetchID) {\n          setState({\n            ...getResetState(\"loading\", false),\n          });\n          setData(res);\n          onSuccess?.(res, isUpdate);\n          return [undefined, res];\n        }\n      } catch (err) {\n        if (cID === self.fetchID) {\n          setState({\n            ...getResetState(\"error\", err),\n          });\n          onError?.(err);\n          return [err, undefined];\n        }\n      } finally {\n        // 清理当前计时器\n        cTimeoutTimer && GLOBAL.clearTimeout(cTimeoutTimer);\n\n        if (cID === self.fetchID) {\n          onComplete?.();\n          self.fetchCount++;\n        }\n      }\n\n      // 仅用于保证类型正确\n      return [new Error(\"never execute\"), null];\n    },\n    (fn) => {\n      if (throttleInterval) {\n        return _throttle(fn, throttleInterval, { trailing: false }); // 对于请求，应该禁止尾随调用\n      }\n\n      if (debounceInterval) {\n        return _debounce(fn, debounceInterval);\n      }\n\n      return fn as any;\n    }\n  );\n\n  /** 手动发起请求 */\n  const send = useFn((newPayload?: Payload) => {\n    const isUpdate = isSyntheticEvent(newPayload) || newPayload === undefined;\n    return fetchHandel(getActualPayload(newPayload), isUpdate);\n  });\n\n  /** 监听param改变并执行缓存更新，发起请求 */\n  useEffectEqual(() => {\n    if (!(\"param\" in options)) return;\n    if (self.fetchCount === 0 || manual) return;\n    fetchHandel(getActualPayload(), false); // 走到这里说明参数已经改变了\n  }, [param]);\n\n  /** 执行一些自动触发请求的操作 */\n  useEffect(() => {\n    if (manual || !pass) return;\n    // 初次请求时，如果有数据且禁用了stale，取消请求\n    if (!stale && self.fetchCount === 0 && !isEmpty(data)) {\n      setState({\n        loading: false,\n      });\n      return;\n    }\n    fetchHandel(getActualPayload(), self.fetchCount !== 0);\n  }, [pass, ...deps]);\n\n  /** 轮询处理 */\n  useEffect(\n    function intervalHandle() {\n      let timer: number;\n\n      if (polling && pollingInterval && pollingInterval > 500) {\n        timer = GLOBAL.setInterval(() => {\n          const now = Date.now();\n          const last = self.lastFetch;\n          const reFetch = now - last >= pollingInterval;\n          reFetch && send();\n        }, pollingInterval);\n      }\n\n      return () => {\n        timer && clearInterval(timer);\n      };\n    },\n    [pollingInterval, polling]\n  );\n\n  /** 接受可选的新payload，并根据条件返回传递给fetchHandel的参数(使用param或payload) */\n  function getActualPayload(newPayload?: Payload) {\n    // 包含param配置项，使用当前param更新\n    if (\"param\" in options) {\n      return param;\n    }\n\n    // 参数为合成事件或未传，视为更新请求，使用当前payload进行更新请求\n    if (isSyntheticEvent(newPayload) || newPayload === undefined) {\n      return payload;\n    }\n\n    // 包含新的payload，更新payload值并使用新的payload更新请求\n    setPayload(newPayload as Payload); // 同步新的payload\n    return newPayload;\n  }\n\n  /** 返回一个将互斥的状态还原的对象，并通过键值覆盖设置某个值 */\n  function getResetState(key?: string, value?: any) {\n    const resetState: any = {\n      loading: false,\n      error: undefined,\n      timeout: false,\n    };\n\n    if (key) {\n      resetState[key] = value;\n    }\n\n    return resetState;\n  }\n\n  /** 取消请求 */\n  function cancel() {\n    self.fetchID = 0; // 超时后阻止后续赋值操作\n    self.timeoutTimer && GLOBAL.clearTimeout(self.timeoutTimer);\n    setState({\n      loading: false,\n    });\n  }\n\n  return {\n    ...state,\n    send,\n    data,\n    payload,\n    param,\n    setData,\n    cancel,\n    polling,\n    setPolling,\n  } as any as UseFetchReturns<Data, Payload>;\n}\n\nexport { useFetch };\n"],"names":["__GLOBAL__","isEmpty","isFunction","isObject","_debounce","_throttle","React","useEffect","useState","useEffectEqual","useFn","useSelf","useSetState","useStorageState","GLOBAL","isSyntheticEvent","arg","useFetch","method","options","getActualPayload","newPayload","param","undefined","payload","setPayload","getResetState","key","value","resetState","loading","error","timeout","cancel","self","fetchID","timeoutTimer","clearTimeout","setState","fetchCount","lastFetch","Date","now","initData","initPayload","deps","manual","onSuccess","onError","onComplete","onTimeout","cacheKey","stale","throttleInterval","debounceInterval","pollingInterval","aPass","pass","isCache","state","disabled","data","setData","polling","setPolling","fetchHandel","_fetchHandel","args","isUpdate","cID","cTimeoutTimer","res","err","Error","Math","random","setTimeout","fn","trailing","send","intervalHandle","timer","setInterval","last","reFetch","clearInterval"],"mappings":"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"}