{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/state/useQueue/useQueue.ts"],"sourcesContent":["import { AnyObject, createRandString, isArray, isNumber } from \"@m78/utils\";\nimport { useFn, useSelf, useSetState, useUpdate } from \"@m78/hooks\";\nimport _differenceBy from \"lodash/differenceBy\";\nimport { useEffect } from \"react\";\n\ntype IDType = string | number;\n\ninterface UseQueueConfig<ItemOption> {\n  /** 初始列表 */\n  list?: (ItemOption & UseQueueItem)[];\n  /** 默认项配置 */\n  defaultItemOption?: Partial<ItemOption & UseQueueItem>;\n  /** 是否默认为手动模式 */\n  defaultManual?: boolean;\n  /** 每次current变更时触发 */\n  onChange?: (current?: ItemOption & UseQueueItem) => void;\n}\n\ninterface UseQueueItem {\n  /** 自动模式时，如果传入此项，会在此延迟(ms)后自动切换到下一项 */\n  duration?: number;\n  /** 唯一id，如果未传入会由内部自动生成一个随机id */\n  id?: IDType;\n}\n\ninterface UseQueueItemWidthId extends UseQueueItem {\n  id: IDType;\n}\n\n/*\n * old[] <->  current  <-> list[]\n * */\n\nfunction useQueue<Item extends AnyObject = {}>(\n  {\n    defaultItemOption,\n    list = [],\n    defaultManual = false,\n    onChange,\n  } = {} as UseQueueConfig<Item>\n) {\n  /** 选项与用户扩展类型混合 */\n  type MixItem = Item & UseQueueItem;\n  type MixItemWithId = Item & UseQueueItemWidthId;\n\n  const self = useSelf({\n    /** 消息队列 */\n    list: [] as MixItemWithId[],\n    /** 历史记录 */\n    oldList: [] as MixItemWithId[],\n    /** 开启下一条的计时器 */\n    timer: null as any,\n    /** 设置计时器的时间 */\n    timerSetTime: null as number | null,\n    /** 暂停的时间 */\n    pauseTime: null as number | null,\n  });\n\n  const [state, setState] = useSetState({\n    /** 当前显示消息 */\n    current: null as MixItemWithId | null,\n    /** 是否暂停 */\n    manual: defaultManual,\n  });\n\n  const update = useUpdate();\n\n  // 清理\n  useEffect(() => clearTimer, []);\n\n  /**\n   * next()的实现版本，支持参数\n   * */\n  const nextIn = useFn((isPrev?: boolean) => {\n    clearTimer();\n\n    const nextCurrent = self.list[0] || null;\n\n    // 将当前项添加到历史\n    if (!isPrev && state.current) {\n      self.oldList.push(state.current);\n    }\n\n    if (!nextCurrent) {\n      setState({\n        current: null,\n      });\n      return;\n    }\n\n    // 移除新项\n    self.list.splice(0, 1);\n\n    // self.oldList.push(...del);\n\n    setState({\n      current: nextCurrent,\n    });\n\n    onChange?.(nextCurrent);\n\n    // 未暂停且配置了持续时间, 定时切换到下一条\n    if (isNumber(nextCurrent.duration) && !state.manual) {\n      self.timer = setTimeout(nextIn, nextCurrent.duration);\n      self.timerSetTime = Date.now();\n    }\n\n    // 如果切换过，暂停时间就没意义了，将其清除\n    self.pauseTime = null;\n  });\n\n  /**\n   * 切换到下一项\n   * */\n  const next = useFn(() => nextIn() /* 过滤参数 */);\n\n  /**\n   * 切换到上一项\n   * */\n  const prev = useFn(() => {\n    const lastOldInd = self.oldList.length - 1; // 最后一条是当前消息\n\n    const old = self.oldList.splice(lastOldInd, 1);\n\n    if (!old.length) return;\n\n    // 当前消息和上一条消息重新放回队列\n\n    state.current && self.list.unshift(state.current);\n\n    self.list.unshift(...old);\n\n    nextIn(true);\n  });\n\n  /**\n   * 推入一个或一组新项，如果当前没有选中项且非手动模式，自动执行next()\n   * @param opt - 要添加的新项，可以是一个单独的项配置或配置数组\n   * */\n  const push = useFn((opt: MixItem | MixItem[]) => {\n    if (isArray(opt)) {\n      const ls = opt.map((item) => ({\n        ...defaultItemOption,\n        id: createRandString(),\n        ...item,\n      }));\n      self.list.push(...ls);\n    } else {\n      self.list.push({ ...defaultItemOption, id: createRandString(), ...opt });\n    }\n\n    if (state.current || state.manual) update();\n    else next();\n  });\n\n  /**\n   * 跳转到指定id项，该项左侧所有项会被移到历史列表，右侧所有项会移到待执行列表\n   * */\n  const jump = useFn((id: IDType) => {\n    clearTimer();\n\n    const all = getAllList();\n\n    const cInd = findIndexById(id);\n\n    const leftList = all.slice(0, cInd);\n\n    const rightList = all.slice(cInd);\n\n    self.oldList = leftList;\n    self.list = rightList;\n    setState({\n      current: null,\n    });\n\n    nextIn();\n  });\n\n  /** 完全移除指定id或一组id的项, 如果你要关闭当前消息，应当使用next而不是remove，因为此方法会破坏队列的完整性 */\n  const remove = useFn((id: IDType | IDType[]) => {\n    const ids = isArray(id) ? id : [id];\n\n    if (!ids.length) return;\n\n    const diffList = (ls: MixItemWithId[]) =>\n      _differenceBy(\n        ls,\n        ids.map((item) => ({ id: item })),\n        (item) => item.id\n      );\n\n    self.oldList = diffList(self.oldList);\n\n    self.list = diffList(self.list);\n\n    if (state.current && ids.includes(state.current.id)) {\n      setState({\n        current: null,\n      });\n    } else {\n      update();\n    }\n  });\n\n  // 启动初始list\n  useEffect(() => {\n    if (list.length) {\n      push(list); // +执行next()\n    }\n  }, []);\n\n  /**\n   * 清空队列\n   * */\n  const clear = useFn(() => {\n    self.list = [];\n    self.oldList = [];\n    self.timer = null;\n    self.timerSetTime = null;\n    self.pauseTime = null;\n    clearTimer();\n    setState({\n      current: null,\n      manual: false,\n    });\n  });\n\n  /**\n   * 从自动模式切换为启用手动模式，暂停所有计时器\n   * */\n  const manual = useFn(() => {\n    if (state.manual) return;\n\n    setState({\n      manual: true,\n    });\n\n    clearTimeout(self.timer);\n\n    self.pauseTime = Date.now();\n  });\n\n  /**\n   * 从手动模式切换为自动模式, 如果包含暂停的计时器，会从暂停位置重新开始\n   * */\n  const auto = useFn(() => {\n    if (!state.manual) return;\n\n    setState({\n      manual: false,\n    });\n\n    const c = state.current;\n\n    // 如果当前有选中项，且包含计时器, 根据打断时间重新设置计时器\n    if (c) {\n      clearTimeout(self.timer);\n\n      // 包含必要参数，还原暂停时间\n      if (self.pauseTime && self.timerSetTime) {\n        const spend = self.pauseTime - self.timerSetTime;\n\n        if (isNumber(c.duration) && isNumber(spend)) {\n          self.timer = setTimeout(next, c.duration - spend);\n        }\n\n        // 使用默认时间\n      } else if (isNumber(c.duration)) {\n        self.timer = setTimeout(next, c.duration);\n      }\n    } else {\n      // 没有消息时重新启用队列\n      next();\n    }\n\n    self.pauseTime = null;\n  });\n\n  /**\n   * 指定id是否包含下一项, 不传id查当前项\n   * */\n  function hasNext(id?: IDType) {\n    if (!id && !state.current) {\n      return !!self.list.length;\n    }\n\n    const _id = id || state.current?.id;\n\n    if (!_id) return false;\n\n    const all = getAllList();\n    const ind = findIndexById(_id!);\n    return !!all[ind + 1];\n  }\n\n  /**\n   * 指定id是否包含上一项, 不传id查当前项\n   * */\n  function hasPrev(id?: IDType) {\n    let _id = id;\n\n    if (!_id && !state.current) return false;\n\n    if (!_id) {\n      _id = state.current?.id;\n    }\n\n    const all = getAllList();\n    const ind = findIndexById(_id!);\n    return !!all[ind - 1];\n  }\n\n  /**\n   * 查询指定id在列表中的索引\n   * */\n  function findIndexById(id: IDType) {\n    const all = getAllList();\n    return all.findIndex((item) => item.id === id);\n  }\n\n  /**\n   * 获取所有列表和当前项组成的数组, 历史和当前列表\n   * */\n  function getAllList() {\n    const ls: MixItemWithId[] = [];\n    ls.push(...self.oldList);\n\n    if (state.current) {\n      ls.push(state.current);\n    }\n\n    ls.push(...self.list);\n\n    return ls;\n  }\n\n  function clearTimer() {\n    if (self.timer) {\n      clearTimeout(self.timer);\n      self.timerSetTime = null;\n    }\n  }\n\n  return {\n    push,\n    prev,\n    next,\n    jump,\n    hasNext,\n    hasPrev,\n    clear,\n    findIndexById,\n    isManual: state.manual,\n    current: state.current,\n    auto,\n    manual,\n    list: getAllList(),\n    leftList: self.oldList,\n    rightList: self.list,\n    index: state.current ? findIndexById(state.current.id) : null,\n    remove,\n  };\n}\n\nexport { useQueue, UseQueueConfig, UseQueueItem };\n"],"names":["createRandString","isArray","isNumber","useFn","useSelf","useSetState","useUpdate","_differenceBy","useEffect","useQueue","defaultItemOption","list","defaultManual","onChange","hasNext","id","state","current","self","length","_id","all","getAllList","ind","findIndexById","hasPrev","findIndex","item","ls","push","oldList","clearTimer","timer","clearTimeout","timerSetTime","pauseTime","manual","setState","update","nextIn","isPrev","nextCurrent","splice","duration","setTimeout","Date","now","next","prev","lastOldInd","old","unshift","opt","map","jump","cInd","leftList","slice","rightList","remove","ids","diffList","includes","clear","auto","c","spend","isManual","index"],"mappings":"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"}