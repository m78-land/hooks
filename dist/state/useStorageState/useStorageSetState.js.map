{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/state/useStorageState/useStorageSetState.ts"],"sourcesContent":["import { useState, useCallback } from \"react\";\nimport {\n  StateInitState,\n  UseSetStateTuple,\n  UseStorageStateOptions,\n  useStorageState,\n} from \"@m78/hooks\";\nimport { AnyObject } from \"@m78/utils\";\n\nexport const useStorageSetState = <T extends AnyObject>(\n  /** 缓存key */\n  key: string,\n  /** 初始状态 */\n  initState = {} as StateInitState<T>,\n  /** 其他选项 */\n  options?: UseStorageStateOptions\n): UseSetStateTuple<T> => {\n  const [, update] = useState(0);\n  const [state, set] = useStorageState<T>(key, initState, options);\n  const setState = useCallback(\n    (patch: any) => {\n      // 关键是使用Object.assign保证引用不变\n      set(\n        Object.assign(state, patch instanceof Function ? patch(state) : patch)\n      );\n      // 引用相同useState是不会更新的，需要手动触发更新\n      update((prev) => prev + 1);\n    },\n    [set]\n  );\n\n  return [state, setState];\n};\n"],"names":["useState","useCallback","useStorageState","useStorageSetState","key","initState","options","update","state","set","setState","patch","Object","assign","Function","prev"],"mappings":"AAAA;AAAA,SAASA,QAAQ,EAAEC,WAAW,QAAQ,OAAO,CAAC;AAC9C,SAIEC,eAAe,QACV,YAAY,CAAC;AAGpB,OAAO,IAAMC,kBAAkB,GAAG,SAChC,UAAU,GACVC,GAAW,EAKa;QAJxB,SAAS,GACTC,SAAS,oEAAG,EAAE,EACd,SAAS,GACTC,OAAgC;IAEhC,IAAmBN,GAAW,oBAAXA,QAAQ,CAAC,CAAC,CAAC,IAAA,EAArBO,MAAM,GAAIP,GAAW,GAAf,AAAgB;IAC/B,IAAqBE,IAA2C,oBAA3CA,eAAe,CAAIE,GAAG,EAAEC,SAAS,EAAEC,OAAO,CAAC,IAAA,EAAzDE,KAAK,GAASN,IAA2C,GAApD,EAAEO,GAAG,GAAIP,IAA2C,GAA/C,AAAgD;IACjE,IAAMQ,QAAQ,GAAGT,WAAW,CAC1B,SAACU,KAAU,EAAK;QACd,2BAA2B;QAC3BF,GAAG,CACDG,MAAM,CAACC,MAAM,CAACL,KAAK,EAAEG,KAAK,YAAYG,QAAQ,GAAGH,KAAK,CAACH,KAAK,CAAC,GAAGG,KAAK,CAAC,CACvE,CAAC;QACF,8BAA8B;QAC9BJ,MAAM,CAAC,SAACQ,IAAI;mBAAKA,IAAI,GAAG,CAAC;SAAA,CAAC,CAAC;IAC7B,CAAC,EACD;QAACN,GAAG;KAAC,CACN,AAAC;IAEF,OAAO;QAACD,KAAK;QAAEE,QAAQ;KAAC,CAAC;AAC3B,CAAC,CAAC"}