{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/state/useDelayToggle/useDelayToggle.ts"],"sourcesContent":["/**\n * 将转入的开关状态在指定延迟后转为本地状态并在变更后同步\n * */\nimport { useState, useEffect } from \"react\";\nimport { useSelf } from \"@m78/hooks\";\n\nexport function useDelayToggle(\n  toggle: boolean,\n  delay = 300,\n  options?: {\n    /** 禁用延迟功能 */\n    disabled?: boolean;\n    /** 开启延迟，默认为delay的值 */\n    leadingDelay?: number;\n    /** 离场延迟，默认为delay的值 */\n    trailingDelay?: number;\n    /** true | 启用入场延迟 */\n    leading?: boolean;\n    /** false | 启用离场延迟 */\n    trailing?: boolean;\n  }\n): boolean {\n  const {\n    disabled,\n    leadingDelay = delay,\n    trailingDelay = delay,\n    trailing,\n    leading = true,\n  } = options || {};\n\n  const isDisabled = !delay || disabled || (!trailing && !leading);\n\n  // 初始值在禁用或未开启前导延迟时为toggle本身，否则为false\n  const [innerState, setInnerState] = useState(toggle);\n\n  const self = useSelf({\n    toggleTimer: null as any,\n  });\n\n  useEffect(() => {\n    if (isDisabled) return;\n\n    if ((toggle && !leading) || (!toggle && !trailing)) {\n      toggle !== innerState && setInnerState(toggle);\n      return;\n    }\n\n    const d = toggle ? leadingDelay : trailingDelay;\n\n    self.toggleTimer = setTimeout(() => {\n      setInnerState(toggle);\n    }, d);\n\n    return () => {\n      self.toggleTimer && clearTimeout(self.toggleTimer);\n    };\n  }, [toggle]);\n\n  return isDisabled ? toggle : innerState;\n}\n"],"names":["useState","useEffect","useSelf","useDelayToggle","toggle","delay","options","disabled","leadingDelay","trailingDelay","trailing","leading","isDisabled","innerState","setInnerState","self","toggleTimer","d","setTimeout","clearTimeout"],"mappings":"AAAA;;GAEG,GACH;AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO,CAAC;AAC5C,SAASC,OAAO,QAAQ,YAAY,CAAC;AAErC,OAAO,SAASC,cAAc,CAC5BC,MAAe,EAcN;QAbTC,KAAK,GAALA,+CAAW,kBAAH,GAAG,EACXC,OAWC,+CAAA;IAED,IAMIA,GAAa,GAAbA,OAAO,IAAI,EAAE,EALfC,QAAQ,GAKND,GAAa,CALfC,QAAQ,kBAKND,GAAa,CAJfE,YAAY,EAAZA,YAAY,8BAAGH,KAAK,gBAAA,mBAIlBC,GAAa,CAHfG,aAAa,EAAbA,aAAa,+BAAGJ,KAAK,iBAAA,EACrBK,QAAQ,GAENJ,GAAa,CAFfI,QAAQ,aAENJ,GAAa,CADfK,OAAO,EAAPA,OAAO,yBAAG,IAAI,WAAA,AACE;IAElB,IAAMC,UAAU,GAAG,CAACP,KAAK,IAAIE,QAAQ,IAAK,CAACG,QAAQ,IAAI,CAACC,OAAO,AAAC,AAAC;IAEjE,oCAAoC;IACpC,IAAoCX,IAAgB,oBAAhBA,QAAQ,CAACI,MAAM,CAAC,IAAA,EAA7CS,UAAU,GAAmBb,IAAgB,GAAnC,EAAEc,aAAa,GAAId,IAAgB,GAApB,AAAqB;IAErD,IAAMe,IAAI,GAAGb,OAAO,CAAC;QACnBc,WAAW,EAAE,IAAI;KAClB,CAAC,AAAC;IAEHf,SAAS,CAAC,WAAM;QACd,IAAIW,UAAU,EAAE,OAAO;QAEvB,IAAI,AAACR,MAAM,IAAI,CAACO,OAAO,IAAM,CAACP,MAAM,IAAI,CAACM,QAAQ,AAAC,EAAE;YAClDN,MAAM,KAAKS,UAAU,IAAIC,aAAa,CAACV,MAAM,CAAC,CAAC;YAC/C,OAAO;QACT,CAAC;QAED,IAAMa,CAAC,GAAGb,MAAM,GAAGI,YAAY,GAAGC,aAAa,AAAC;QAEhDM,IAAI,CAACC,WAAW,GAAGE,UAAU,CAAC,WAAM;YAClCJ,aAAa,CAACV,MAAM,CAAC,CAAC;QACxB,CAAC,EAAEa,CAAC,CAAC,CAAC;QAEN,OAAO,WAAM;YACXF,IAAI,CAACC,WAAW,IAAIG,YAAY,CAACJ,IAAI,CAACC,WAAW,CAAC,CAAC;QACrD,CAAC,CAAC;IACJ,CAAC,EAAE;QAACZ,MAAM;KAAC,CAAC,CAAC;IAEb,OAAOQ,UAAU,GAAGR,MAAM,GAAGS,UAAU,CAAC;AAC1C,CAAC"}