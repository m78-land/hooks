{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/state/useDelayToggle/useDelayToggle.ts"],"sourcesContent":["/**\n * 将转入的开关状态在指定延迟后转为本地状态并在变更后同步\n * */\nimport { useState, useEffect } from \"react\";\nimport { useSelf } from \"@m78/hooks\";\n\nexport function useDelayToggle(\n  toggle: boolean,\n  delay = 300,\n  options?: {\n    /** 禁用延迟功能 */\n    disabled?: boolean;\n    /** 开启延迟，默认为delay的值 */\n    leadingDelay?: number;\n    /** 离场延迟，默认为delay的值 */\n    trailingDelay?: number;\n    /** true | 启用入场延迟 */\n    leading?: boolean;\n    /** false | 启用离场延迟 */\n    trailing?: boolean;\n  }\n): boolean {\n  const {\n    disabled,\n    leadingDelay = delay,\n    trailingDelay = delay,\n    trailing,\n    leading = true,\n  } = options || {};\n\n  const isDisabled = !delay || disabled || (!trailing && !leading);\n\n  // 初始值在禁用或未开启前导延迟时为toggle本身，否则为false\n  const [innerState, setInnerState] = useState(toggle);\n\n  const self = useSelf({\n    toggleTimer: null as any,\n  });\n\n  useEffect(() => {\n    if (isDisabled) return;\n\n    if ((toggle && !leading) || (!toggle && !trailing)) {\n      toggle !== innerState && setInnerState(toggle);\n      return;\n    }\n\n    const d = toggle ? leadingDelay : trailingDelay;\n\n    self.toggleTimer = setTimeout(() => {\n      setInnerState(toggle);\n    }, d);\n\n    return () => {\n      self.toggleTimer && clearTimeout(self.toggleTimer);\n    };\n  }, [toggle]);\n\n  return isDisabled ? toggle : innerState;\n}\n"],"names":["useDelayToggle","toggle","delay","options","disabled","leadingDelay","trailingDelay","trailing","leading","isDisabled","useState","innerState","setInnerState","self","useSelf","toggleTimer","useEffect","d","setTimeout","clearTimeout"],"mappings":"AAAA;;GAEG,GACH;qJAAoC,OAAO,WACnB,YAAY;;;;QADA,OAAO;QACnB,YAAY;;;;;;;;mCAEpBA,gBAAc;;;mBAAdA,cAAc;;;;IAAvB,SAASA,cAAc,CAC5BC,MAAe,EAcN;YAbTC,KAAK,GAALA,+CAAW,kBAAH,GAAG,EACXC,OAWC,+CAAA;QAED,IAMIA,GAAa,GAAbA,OAAO,IAAI,EAAE,EALfC,QAAQ,GAKND,GAAa,CALfC,QAAQ,kBAKND,GAAa,CAJfE,YAAY,EAAZA,YAAY,8BAAGH,KAAK,gBAAA,mBAIlBC,GAAa,CAHfG,aAAa,EAAbA,aAAa,+BAAGJ,KAAK,iBAAA,EACrBK,QAAQ,GAENJ,GAAa,CAFfI,QAAQ,aAENJ,GAAa,CADfK,OAAO,EAAPA,OAAO,yBAAG,IAAI,WAAA,AACE;QAElB,IAAMC,UAAU,GAAG,CAACP,KAAK,IAAIE,QAAQ,IAAK,CAACG,QAAQ,IAAI,CAACC,OAAO,AAAC,AAAC;QAEjE,oCAAoC;QACpC,IAAoCE,IAAgB,kBAAhBA,IAAAA,MAAQ,SAAA,EAACT,MAAM,CAAC,IAAA,EAA7CU,UAAU,GAAmBD,IAAgB,GAAnC,EAAEE,aAAa,GAAIF,IAAgB,GAApB,AAAqB;QAErD,IAAMG,KAAI,GAAGC,IAAAA,MAAO,QAAA,EAAC;YACnBC,WAAW,EAAE,IAAI;SAClB,CAAC,AAAC;QAEHC,IAAAA,MAAS,UAAA,EAAC,WAAM;YACd,IAAIP,UAAU,EAAE,OAAO;YAEvB,IAAI,AAACR,MAAM,IAAI,CAACO,OAAO,IAAM,CAACP,MAAM,IAAI,CAACM,QAAQ,AAAC,EAAE;gBAClDN,MAAM,KAAKU,UAAU,IAAIC,aAAa,CAACX,MAAM,CAAC,CAAC;gBAC/C,OAAO;YACT,CAAC;YAED,IAAMgB,CAAC,GAAGhB,MAAM,GAAGI,YAAY,GAAGC,aAAa,AAAC;YAEhDO,KAAI,CAACE,WAAW,GAAGG,UAAU,CAAC,WAAM;gBAClCN,aAAa,CAACX,MAAM,CAAC,CAAC;YACxB,CAAC,EAAEgB,CAAC,CAAC,CAAC;YAEN,OAAO,WAAM;gBACXJ,KAAI,CAACE,WAAW,IAAII,YAAY,CAACN,KAAI,CAACE,WAAW,CAAC,CAAC;YACrD,CAAC,CAAC;QACJ,CAAC,EAAE;YAACd,MAAM;SAAC,CAAC,CAAC;QAEb,OAAOQ,UAAU,GAAGR,MAAM,GAAGU,UAAU,CAAC;IAC1C,CAAC"}