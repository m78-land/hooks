{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/state/useStorageState/useStorageSetState.ts"],"sourcesContent":["import { useState, useCallback } from \"react\";\nimport {\n  StateInitState,\n  UseSetStateTuple,\n  UseStorageStateOptions,\n  useStorageState,\n} from \"@m78/hooks\";\nimport { AnyObject } from \"@m78/utils\";\n\nexport const useStorageSetState = <T extends AnyObject>(\n  /** 缓存key */\n  key: string,\n  /** 初始状态 */\n  initState = {} as StateInitState<T>,\n  /** 其他选项 */\n  options?: UseStorageStateOptions\n): UseSetStateTuple<T> => {\n  const [, update] = useState(0);\n  const [state, set] = useStorageState<T>(key, initState, options);\n  const setState = useCallback(\n    (patch: any) => {\n      // 关键是使用Object.assign保证引用不变\n      set(\n        Object.assign(state, patch instanceof Function ? patch(state) : patch)\n      );\n      // 引用相同useState是不会更新的，需要手动触发更新\n      update((prev) => prev + 1);\n    },\n    [set]\n  );\n\n  return [state, setState];\n};\n"],"names":["useStorageSetState","key","initState","options","useState","update","useStorageState","state","set","setState","useCallback","patch","Object","assign","Function","prev"],"mappings":"AAAA;qJAAsC,OAAO,WAMtC,YAAY;;;;QANmB,OAAO;QAMtC,YAAY;;;;;;;;mCAGNA,oBAAkB;;;mBAAlBA,kBAAkB;;;;IAAxB,IAAMA,kBAAkB,GAAG,SAChC,UAAU,GACVC,GAAW,EAKa;YAJxB,SAAS,GACTC,SAAS,oEAAG,EAAE,EACd,SAAS,GACTC,OAAgC;QAEhC,IAAmBC,GAAW,kBAAXA,IAAAA,MAAQ,SAAA,EAAC,CAAC,CAAC,IAAA,EAArBC,MAAM,GAAID,GAAW,GAAf,AAAgB;QAC/B,IAAqBE,IAA2C,kBAA3CA,IAAAA,MAAe,gBAAA,EAAIL,GAAG,EAAEC,SAAS,EAAEC,OAAO,CAAC,IAAA,EAAzDI,KAAK,GAASD,IAA2C,GAApD,EAAEE,GAAG,GAAIF,IAA2C,GAA/C,AAAgD;QACjE,IAAMG,QAAQ,GAAGC,IAAAA,MAAW,YAAA,EAC1B,SAACC,KAAU,EAAK;YACd,2BAA2B;YAC3BH,GAAG,CACDI,MAAM,CAACC,MAAM,CAACN,KAAK,EAAEI,KAAK,YAAYG,QAAQ,GAAGH,KAAK,CAACJ,KAAK,CAAC,GAAGI,KAAK,CAAC,CACvE,CAAC;YACF,8BAA8B;YAC9BN,MAAM,CAAC,SAACU,IAAI;uBAAKA,IAAI,GAAG,CAAC;aAAA,CAAC,CAAC;QAC7B,CAAC,EACD;YAACP,GAAG;SAAC,CACN,AAAC;QAEF,OAAO;YAACD,KAAK;YAAEE,QAAQ;SAAC,CAAC;IAC3B,CAAC,AAAC"}