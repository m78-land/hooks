{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/ui/useLockBodyScroll/useLockBodyScroll.ts"],"sourcesContent":["import { useEffect, useMemo, useRef } from \"react\";\nimport { createRandString, hasScroll } from \"@m78/utils\";\n\nlet scrollPosition = 0; // 保存锁定时的滚动位置\n\nconst list: any = [];\n\n/**\n * 锁定滚动条并对滚动条宽度进行修正\n * @param locked - 根据传入值对滚动条进行锁定/解锁\n * */\nexport const useLockBodyScroll = (locked: boolean) => {\n  const id = useMemo(() => createRandString(), []);\n\n  const instance = useRef({\n    bodyEl: null! as HTMLElement,\n  });\n\n  useEffect(() => {\n    instance.current.bodyEl = document.body;\n  }, []);\n\n  // 存取list\n  useEffect(() => {\n    if (locked) {\n      list.push(id);\n      if (list.length === 1) lock();\n    }\n    return () => {\n      if (!locked) return;\n      const ind = list.indexOf(id);\n      if (ind !== -1) list.splice(ind, 1);\n      if (!list.length) unlock();\n    };\n  }, [locked]);\n\n  function lock() {\n    const bodyEl = instance.current.bodyEl;\n\n    // 不同浏览器会使用不同的根滚动，这里需要进行一下兼容\n    const bodyScrollInfo = hasScroll(bodyEl);\n    const docScrollInfo = hasScroll(document.documentElement);\n\n    const hasX = bodyScrollInfo.x || docScrollInfo.x;\n    const hasY = bodyScrollInfo.y || docScrollInfo.y;\n\n    bodyEl.setAttribute(\"data-locked\", \"1\");\n    scrollPosition = window.pageYOffset;\n    bodyEl.style.width = \"100%\";\n    bodyEl.style.overflowY = hasY ? \"scroll\" : \"hidden\";\n    bodyEl.style.overflowX = hasX ? \"scroll\" : \"hidden\";\n    bodyEl.style.position = \"fixed\";\n    bodyEl.style.top = `-${scrollPosition}px`;\n  }\n\n  function unlock() {\n    const bodyEl = instance.current.bodyEl;\n\n    bodyEl.setAttribute(\"data-locked\", \"0\");\n    bodyEl.style.width = \"\";\n    bodyEl.style.overflowY = \"\";\n    bodyEl.style.overflowX = \"\";\n    bodyEl.style.position = \"\";\n    bodyEl.style.top = \"\";\n    window.scrollTo(0, scrollPosition);\n  }\n};\n"],"names":["useLockBodyScroll","scrollPosition","list","locked","lock","bodyEl","instance","current","bodyScrollInfo","hasScroll","docScrollInfo","document","documentElement","hasX","x","hasY","y","setAttribute","window","pageYOffset","style","width","overflowY","overflowX","position","top","unlock","scrollTo","id","useMemo","createRandString","useRef","useEffect","body","push","length","ind","indexOf","splice"],"mappings":"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"}