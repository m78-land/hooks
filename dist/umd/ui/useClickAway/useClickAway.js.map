{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/ui/useClickAway/useClickAway.ts"],"sourcesContent":["import { useEffect, useMemo, useRef } from \"react\";\nimport { isArray } from \"@m78/utils\";\nimport { DomTarget, getTargetDomList, useFn } from \"@m78/hooks\";\n\nexport interface UseClickAwayConfig {\n  /** 触发回调, e取决于events配置, 用户可根据events自行进行类型断言 */\n  onTrigger: (e: Event) => void;\n  /** 监听目标, 可以是单个或多个DOM/包含DOM的react ref */\n  target?: DomTarget | DomTarget[];\n  /** ['mousedown', 'touchstart'] | 要触发的事件 */\n  events?: string[];\n}\n\nconst defaultEvents = [\"mousedown\", \"touchstart\"];\n\nexport function useClickAway({\n  target,\n  events = defaultEvents,\n  onTrigger,\n}: UseClickAwayConfig) {\n  const ref = useRef<any>();\n  const domList = useRef<HTMLElement[]>([]);\n\n  const handle: EventListener = useFn((e) => {\n    if (!domList.current.length) return;\n\n    const isInner = domList.current.some((dom) => {\n      return dom.contains(e.target as Node);\n    });\n\n    !isInner && onTrigger(e);\n  });\n\n  const targetLs = useMemo(() => {\n    const r: DomTarget = ref;\n    if (!target) return [r];\n    if (!isArray(target)) return [target, r];\n    return [...target, r];\n  }, [target, ref.current]);\n\n  useEffect(() => {\n    domList.current = getTargetDomList(targetLs) || [];\n  }, targetLs);\n\n  useEffect(() => {\n    bindHelper();\n    return () => bindHelper(true);\n  }, events);\n\n  function bindHelper(isOff = false) {\n    events!.forEach((eventKey) => {\n      document[isOff ? \"removeEventListener\" : \"addEventListener\"](\n        eventKey,\n        handle\n      );\n    });\n  }\n\n  return ref;\n}\n"],"names":["useClickAway","defaultEvents","target","events","onTrigger","bindHelper","isOff","forEach","eventKey","document","handle","ref","useRef","domList","useFn","e","current","length","isInner","some","dom","contains","targetLs","useMemo","r","isArray","useEffect","getTargetDomList"],"mappings":"AAAA;yJAA2C,OAAO,WAC1B,YAAY,WACe,YAAY;;;;QAFpB,OAAO;QAC1B,YAAY;QACe,YAAY;;;;;;;;mCAa/CA,cAAY;;;mBAAZA,YAAY;;;;IAF5B,IAAMC,aAAa,GAAG;QAAC,WAAW;QAAE,YAAY;KAAC,AAAC;IAE3C,SAASD,YAAY,CAAC,KAIR,EAAE;YAHrBE,MAAM,GADqB,KAIR,CAHnBA,MAAM,YADqB,KAIR,CAFnBC,MAAM,EAANA,MAAM,wBAAGF,aAAa,UAAA,EACtBG,SAAS,GAHkB,KAIR,CADnBA,SAAS;YA+BAC,UAAU,GAAnB,SAASA,UAAU,GAAgB;gBAAfC,KAAK,GAALA,+CAAa,kBAAL,KAAK;YAC/BH,MAAM,CAAEI,OAAO,CAAC,SAACC,QAAQ,EAAK;gBAC5BC,QAAQ,CAACH,KAAK,GAAG,qBAAqB,GAAG,kBAAkB,CAAC,CAC1DE,QAAQ,EACRE,MAAM,CACP,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC;QApCD,IAAMC,GAAG,GAAGC,IAAAA,MAAM,OAAA,GAAO,AAAC;QAC1B,IAAMC,OAAO,GAAGD,IAAAA,MAAM,OAAA,EAAgB,EAAE,CAAC,AAAC;QAE1C,IAAMF,MAAM,GAAkBI,IAAAA,MAAK,MAAA,EAAC,SAACC,CAAC,EAAK;YACzC,IAAI,CAACF,OAAO,CAACG,OAAO,CAACC,MAAM,EAAE,OAAO;YAEpC,IAAMC,OAAO,GAAGL,OAAO,CAACG,OAAO,CAACG,IAAI,CAAC,SAACC,GAAG,EAAK;gBAC5C,OAAOA,GAAG,CAACC,QAAQ,CAACN,CAAC,CAACb,MAAM,CAAS,CAAC;YACxC,CAAC,CAAC,AAAC;YAEH,CAACgB,OAAO,IAAId,SAAS,CAACW,CAAC,CAAC,CAAC;QAC3B,CAAC,CAAC,AAAC;QAEH,IAAMO,QAAQ,GAAGC,IAAAA,MAAO,QAAA,EAAC,WAAM;YAC7B,IAAMC,CAAC,GAAcb,GAAG,AAAC;YACzB,IAAI,CAACT,MAAM,EAAE,OAAO;gBAACsB,CAAC;aAAC,CAAC;YACxB,IAAI,CAACC,IAAAA,MAAO,QAAA,EAACvB,MAAM,CAAC,EAAE,OAAO;gBAACA,MAAM;gBAAEsB,CAAC;aAAC,CAAC;YACzC,OAAO,AAAC,mBAAGtB,MAAM,CAANA,QAAJ;gBAAYsB,CAAC;aAAC,CAAA,CAAC;QACxB,CAAC,EAAE;YAACtB,MAAM;YAAES,GAAG,CAACK,OAAO;SAAC,CAAC,AAAC;QAE1BU,IAAAA,MAAS,UAAA,EAAC,WAAM;YACdb,OAAO,CAACG,OAAO,GAAGW,IAAAA,MAAgB,iBAAA,EAACL,QAAQ,CAAC,IAAI,EAAE,CAAC;QACrD,CAAC,EAAEA,QAAQ,CAAC,CAAC;QAEbI,IAAAA,MAAS,UAAA,EAAC,WAAM;YACdrB,UAAU,EAAE,CAAC;YACb,OAAO;uBAAMA,UAAU,CAAC,IAAI,CAAC;aAAA,CAAC;QAChC,CAAC,EAAEF,MAAM,CAAC,CAAC;QAWX,OAAOQ,GAAG,CAAC;IACb,CAAC"}