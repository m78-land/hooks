{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/effect/useThrottle/useThrottle.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport { AnyFunction, __GLOBAL__ } from \"@m78/utils\";\nimport { useFn, useSelf } from \"@m78/hooks\";\n\nexport interface UseThrottleOption {\n  /** true | 在节流开始前调用 */\n  leading?: boolean;\n  /** true | 在节流结束后调用 */\n  trailing?: boolean;\n}\n\nconst defaultOption = {\n  leading: true,\n  trailing: true,\n};\n\n/**\n * 传入一个函数，经过节流处理后返回, 返回函数的内存地址会一直保持不变\n * @param fn - 待节流的函数\n * @param wait - 节流延迟时间\n * @param options\n * @param options.leading - true | 在节流开始前调用\n * @param options.trailing - true | 在节流结束后调用\n * @returns throttleFn - 经过节流处理后的函数\n * @returns throttleFn.cancel() - 取消节流调用\n */\nexport function useThrottle<T extends AnyFunction>(\n  fn: T,\n  wait = 300,\n  options?: UseThrottleOption\n) {\n  const self = useSelf({\n    last: 0,\n    timer: undefined as any,\n  });\n\n  const opt = {\n    ...defaultOption,\n    ...options,\n  };\n\n  const cancel = useFn(() => {\n    if (self.timer) {\n      __GLOBAL__.clearTimeout(self.timer);\n    }\n  });\n\n  useEffect(() => {\n    return cancel;\n  });\n\n  const memoFn = useFn((...args) => {\n    const now = Date.now();\n    const diff = now - self.last;\n\n    cancel();\n\n    if (diff > wait) {\n      // last = 0 时视为初次调用\n      if (opt.leading || self.last !== 0) {\n        fn(...args);\n      }\n      self.last = now;\n    } else if (opt.trailing) {\n      self.timer = __GLOBAL__.setTimeout(() => {\n        fn(...args);\n        self.last = 0; // 标记下次调用为leading调用\n        __GLOBAL__.clearTimeout(self.timer);\n      }, wait);\n    }\n  });\n\n  const bundle = Object.assign(memoFn as T, {\n    cancel,\n  });\n\n  return bundle;\n}\n"],"names":["useThrottle","defaultOption","leading","trailing","fn","wait","options","self","useSelf","last","timer","undefined","opt","cancel","useFn","__GLOBAL__","clearTimeout","useEffect","memoFn","args","now","Date","diff","setTimeout","bundle","Object","assign"],"mappings":"AAAA;yMAA0B,OAAO,WACO,YAAY,WACrB,YAAY;;;;;QAFjB,OAAO;QACO,YAAY;QACrB,YAAY;;;;;;;;mCAwB3BA,aAAW;;;mBAAXA,WAAW;;;;;IAf3B,IAAMC,aAAa,GAAG;QACpBC,OAAO,EAAE,IAAI;QACbC,QAAQ,EAAE,IAAI;KACf,AAAC;IAYK,SAASH,WAAW,CACzBI,EAAK,EAGL;YAFAC,IAAI,GAAJA,+CAAU,kBAAH,GAAG,EACVC,OAA2B,+CAAA;QAE3B,IAAMC,KAAI,GAAGC,IAAAA,MAAO,QAAA,EAAC;YACnBC,IAAI,EAAE,CAAC;YACPC,KAAK,EAAEC,SAAS;SACjB,CAAC,AAAC;QAEH,IAAMC,GAAG,GAAG,kBACPX,aAAa,EACbK,OAAO,CACX,AAAC;QAEF,IAAMO,MAAM,GAAGC,IAAAA,MAAK,MAAA,EAAC,WAAM;YACzB,IAAIP,KAAI,CAACG,KAAK,EAAE;gBACdK,MAAU,cAAA,CAACC,YAAY,CAACT,KAAI,CAACG,KAAK,CAAC,CAAC;YACtC,CAAC;QACH,CAAC,CAAC,AAAC;QAEHO,IAAAA,MAAS,UAAA,EAAC,WAAM;YACd,OAAOJ,MAAM,CAAC;QAChB,CAAC,CAAC,CAAC;QAEH,IAAMK,MAAM,GAAGJ,IAAAA,MAAK,MAAA,EAAC,WAAa;6CAATK,IAAI;gBAAJA,IAAI;;YAC3B,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE,AAAC;YACvB,IAAME,IAAI,GAAGF,GAAG,GAAGb,KAAI,CAACE,IAAI,AAAC;YAE7BI,MAAM,EAAE,CAAC;YAET,IAAIS,IAAI,GAAGjB,IAAI,EAAE;gBACf,mBAAmB;gBACnB,IAAIO,GAAG,CAACV,OAAO,IAAIK,KAAI,CAACE,IAAI,KAAK,CAAC,EAAE;oBAClCL,EAAE,CAAFA,KAAW,CAAXA,KAAAA,CAAE,EAAC,mBAAGe,IAAI,CAAJA,CAAK,CAAC;gBACd,CAAC;gBACDZ,KAAI,CAACE,IAAI,GAAGW,GAAG,CAAC;YAClB,OAAO,IAAIR,GAAG,CAACT,QAAQ,EAAE;gBACvBI,KAAI,CAACG,KAAK,GAAGK,MAAU,cAAA,CAACQ,UAAU,CAAC,WAAM;oBACvCnB,EAAE,CAAFA,KAAW,CAAXA,KAAAA,CAAE,EAAC,mBAAGe,IAAI,CAAJA,CAAK,CAAC;oBACZZ,KAAI,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC,mBAAmB;oBAClCM,MAAU,cAAA,CAACC,YAAY,CAACT,KAAI,CAACG,KAAK,CAAC,CAAC;gBACtC,CAAC,EAAEL,IAAI,CAAC,CAAC;YACX,CAAC;QACH,CAAC,CAAC,AAAC;QAEH,IAAMmB,MAAM,GAAGC,MAAM,CAACC,MAAM,CAACR,MAAM,EAAO;YACxCL,MAAM,EAANA,MAAM;SACP,CAAC,AAAC;QAEH,OAAOW,MAAM,CAAC;IAChB,CAAC"}