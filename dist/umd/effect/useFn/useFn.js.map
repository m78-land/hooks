{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/effect/useFn/useFn.ts"],"sourcesContent":["import { useRef, useMemo } from \"react\";\nimport { AnyFunction } from \"@m78/utils\";\n\n/**\n * 用于代替`useCallback`，使回调函数的引用地址永久不变, 从而减少消费组件不必要的更新。\n * 该hook的另一个用例是解决闭包导致的回调内外状态不一致问题，并且它不需要传递`deps`参数\n * @param fn - 需要`memo`化的函数\n * @param wrapper - 接收fn并返回，可以藉此对函数实现节流等增强操作, 只在初始化和deps改变时调用\n * @param deps - 依赖数组，如果传入，其中任意值改变都会重载缓存的fn，可以用来更新wrapper包装的函数\n * @returns - 经过memo化的函数\n */\nexport function useFn<T extends AnyFunction>(\n  fn: T,\n  wrapper?: (fn: T) => T,\n  deps = [] as any[]\n) {\n  const fnRef = useRef<T>();\n  const memoFnRef = useRef<T>(null!);\n\n  // 更新缓存fn\n  useMemo(() => {\n    if (!memoFnRef.current) return;\n    wrapFn();\n  }, deps);\n\n  // 初始化缓存fn\n  if (!memoFnRef.current) wrapFn();\n\n  /** 兼容devtool，直接写fnRef.current会阻断更新 */\n  (useMemo as any)(() => {\n    fnRef.current = fn;\n  });\n\n  function wrapFn() {\n    function memoFn(this: any, ...args: any) {\n      return fnRef.current!.apply(this, args);\n    }\n\n    memoFnRef.current = wrapper ? wrapper(memoFn as T) : (memoFn as T);\n  }\n\n  return memoFnRef.current;\n}\n"],"names":["useFn","fn","wrapper","deps","wrapFn","memoFn","args","fnRef","current","apply","memoFnRef","useRef","useMemo"],"mappings":"AAAA;mGAAgC,OAAO;;;QAAP,OAAO;;;;;;;;mCAWvBA,OAAK;;;mBAALA,KAAK;;;IAAd,SAASA,KAAK,CACnBC,EAAK,EACLC,OAAsB,EAEtB;YADAC,IAAI,GAAJA,+CAAkB,kBAAX,EAAE,AAAS;YAmBTC,MAAM,GAAf,SAASA,MAAM,GAAG;YAChB,SAASC,MAAM,GAA0B;gBAAd,IAAA,IAAA,IAAY,GAAZ,SAAY,CAAZ,MAAY,EAAZ,AAAGC,IAAI,GAAP,UAAA,IAAY,CAAA,EAAZ,IAAY,GAAZ,CAAY,EAAZ,IAAY,GAAZ,IAAY,EAAZ,IAAY,EAAA,CAAZ;oBAAA,AAAGA,IAAI,CAAP,IAAY,IAAZ,SAAY,AAAZ,CAAA,IAAY,CAAA,CAAA;gBAAD,CAAC;gBACrC,OAAOC,KAAK,CAACC,OAAO,CAAEC,KAAK,CAAC,IAAI,EAAEH,IAAI,CAAC,CAAC;YAC1C,CAAC;YAEDI,SAAS,CAACF,OAAO,GAAGN,OAAO,GAAGA,OAAO,CAACG,MAAM,CAAM,GAAIA,MAAM,AAAM,CAAC;QACrE,CAAC;QAvBD,IAAME,KAAK,GAAGI,IAAAA,MAAM,OAAA,GAAK,AAAC;QAC1B,IAAMD,SAAS,GAAGC,IAAAA,MAAM,OAAA,EAAI,IAAI,CAAE,AAAC;QAEnC,SAAS;QACTC,IAAAA,MAAO,QAAA,EAAC,WAAM;YACZ,IAAI,CAACF,SAAS,CAACF,OAAO,EAAE,OAAO;YAC/BJ,MAAM,EAAE,CAAC;QACX,CAAC,EAAED,IAAI,CAAC,CAAC;QAET,UAAU;QACV,IAAI,CAACO,SAAS,CAACF,OAAO,EAAEJ,MAAM,EAAE,CAAC;QAGjC,IADA,oCAAoC,GACnCQ,MAAO,QAAA,EAAS,WAAM;YACrBL,KAAK,CAACC,OAAO,GAAGP,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAUH,OAAOS,SAAS,CAACF,OAAO,CAAC;IAC3B,CAAC"}