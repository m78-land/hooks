{"version":3,"sources":["/Users/lixianjie/project/openSource/hooks/src/ui/useClickAway/useClickAway.ts"],"sourcesContent":["import { useEffect, useMemo, useRef } from \"react\";\nimport { isArray } from \"@m78/utils\";\nimport { DomTarget, getTargetDomList, useFn } from \"@m78/hooks\";\n\nexport interface UseClickAwayConfig {\n  /** 触发回调, e取决于events配置, 用户可根据events自行进行类型断言 */\n  onTrigger: (e: Event) => void;\n  /** 监听目标, 可以是单个或多个DOM/包含DOM的react ref */\n  target?: DomTarget | DomTarget[];\n  /** ['mousedown', 'touchstart'] | 要触发的事件 */\n  events?: string[];\n}\n\nconst defaultEvents = [\"mousedown\", \"touchstart\"];\n\nexport function useClickAway({\n  target,\n  events = defaultEvents,\n  onTrigger,\n}: UseClickAwayConfig) {\n  const ref = useRef<any>();\n  const domList = useRef<HTMLElement[]>([]);\n\n  const handle: EventListener = useFn((e) => {\n    if (!domList.current.length) return;\n\n    const isInner = domList.current.some((dom) => {\n      return dom.contains(e.target as Node);\n    });\n\n    !isInner && onTrigger(e);\n  });\n\n  const targetLs = useMemo(() => {\n    const r: DomTarget = ref;\n    if (!target) return [r];\n    if (!isArray(target)) return [target, r];\n    return [...target, r];\n  }, [target, ref.current]);\n\n  useEffect(() => {\n    domList.current = getTargetDomList(targetLs) || [];\n  }, targetLs);\n\n  useEffect(() => {\n    bindHelper();\n    return () => bindHelper(true);\n  }, events);\n\n  function bindHelper(isOff = false) {\n    events!.forEach((eventKey) => {\n      document[isOff ? \"removeEventListener\" : \"addEventListener\"](\n        eventKey,\n        handle\n      );\n    });\n  }\n\n  return ref;\n}\n"],"names":["useEffect","useMemo","useRef","isArray","getTargetDomList","useFn","defaultEvents","useClickAway","target","events","onTrigger","bindHelper","isOff","forEach","eventKey","document","handle","ref","domList","e","current","length","isInner","some","dom","contains","targetLs","r"],"mappings":"AAAA;AAAA,SAASA,SAAS,EAAEC,OAAO,EAAEC,MAAM,QAAQ,OAAO,CAAC;AACnD,SAASC,OAAO,QAAQ,YAAY,CAAC;AACrC,SAAoBC,gBAAgB,EAAEC,KAAK,QAAQ,YAAY,CAAC;AAWhE,IAAMC,aAAa,GAAG;IAAC,WAAW;IAAE,YAAY;CAAC,AAAC;AAElD,OAAO,SAASC,YAAY,CAAC,KAIR,EAAE;QAHrBC,MAAM,GADqB,KAIR,CAHnBA,MAAM,YADqB,KAIR,CAFnBC,MAAM,EAANA,MAAM,wBAAGH,aAAa,UAAA,EACtBI,SAAS,GAHkB,KAIR,CADnBA,SAAS;QA+BAC,UAAU,GAAnB,SAASA,UAAU,GAAgB;YAAfC,KAAK,GAALA,+CAAa,kBAAL,KAAK;QAC/BH,MAAM,CAAEI,OAAO,CAAC,SAACC,QAAQ,EAAK;YAC5BC,QAAQ,CAACH,KAAK,GAAG,qBAAqB,GAAG,kBAAkB,CAAC,CAC1DE,QAAQ,EACRE,MAAM,CACP,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;IApCD,IAAMC,GAAG,GAAGf,MAAM,EAAO,AAAC;IAC1B,IAAMgB,OAAO,GAAGhB,MAAM,CAAgB,EAAE,CAAC,AAAC;IAE1C,IAAMc,MAAM,GAAkBX,KAAK,CAAC,SAACc,CAAC,EAAK;QACzC,IAAI,CAACD,OAAO,CAACE,OAAO,CAACC,MAAM,EAAE,OAAO;QAEpC,IAAMC,OAAO,GAAGJ,OAAO,CAACE,OAAO,CAACG,IAAI,CAAC,SAACC,GAAG,EAAK;YAC5C,OAAOA,GAAG,CAACC,QAAQ,CAACN,CAAC,CAACX,MAAM,CAAS,CAAC;QACxC,CAAC,CAAC,AAAC;QAEH,CAACc,OAAO,IAAIZ,SAAS,CAACS,CAAC,CAAC,CAAC;IAC3B,CAAC,CAAC,AAAC;IAEH,IAAMO,QAAQ,GAAGzB,OAAO,CAAC,WAAM;QAC7B,IAAM0B,CAAC,GAAcV,GAAG,AAAC;QACzB,IAAI,CAACT,MAAM,EAAE,OAAO;YAACmB,CAAC;SAAC,CAAC;QACxB,IAAI,CAACxB,OAAO,CAACK,MAAM,CAAC,EAAE,OAAO;YAACA,MAAM;YAAEmB,CAAC;SAAC,CAAC;QACzC,OAAO,AAAC,qBAAGnB,MAAM,CAANA,QAAJ;YAAYmB,CAAC;SAAC,CAAA,CAAC;IACxB,CAAC,EAAE;QAACnB,MAAM;QAAES,GAAG,CAACG,OAAO;KAAC,CAAC,AAAC;IAE1BpB,SAAS,CAAC,WAAM;QACdkB,OAAO,CAACE,OAAO,GAAGhB,gBAAgB,CAACsB,QAAQ,CAAC,IAAI,EAAE,CAAC;IACrD,CAAC,EAAEA,QAAQ,CAAC,CAAC;IAEb1B,SAAS,CAAC,WAAM;QACdW,UAAU,EAAE,CAAC;QACb,OAAO;mBAAMA,UAAU,CAAC,IAAI,CAAC;SAAA,CAAC;IAChC,CAAC,EAAEF,MAAM,CAAC,CAAC;IAWX,OAAOQ,GAAG,CAAC;AACb,CAAC"}